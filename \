module AresMUSH
  module Lucidity
    class PoseEventHandler 
      def on_event(event)
        return if event.is_ooc
        
        char = event.enactor
        room = char.room
        scene = room.scene

        return if scene.nil?

        uwc = event.pose.unique_word_count

        multiplier = scene.watchers.count + scene.participants.count + scene.likers.count

        bounty = uwc * multiplier * Global.read_config("lucidity", "awards", "pose_multiplier")
        char.award(bounty, t('lucidity.award_reasons.pose'))
        
        if room.illusion_present?
          room.illusion_words_remaining -= uwc
          room.illusion_words_remaining = 0 if room.illusion_words_remaining < 0
        end
      end
    end
  end
end

